# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/15Pgloj-PCJUSV8_kJRfieT2c2GGt71ze
"""

import pandas as pd
df = pd.read_csv('Avocado.csv')
region_collection = {}
region_collection_reverse = {}
# get the list of region
for col in df.columns:
  for i in range(len(df[col])):
    if col == 'region':
      if df[col][i] not in region_collection:
        region_collection[df[col][i]] = len(region_collection)
        region_collection_reverse[len(region_collection)-1] = df[col][i]

# load models
import pickle
filename = 'svm_model_price.sav'
price_model = pickle.load(open(filename, 'rb'))
filename = 'svm_model_consumption.sav'
consumption_model = pickle.load(open(filename, 'rb'))

import csv  

header = ['AveragePrice', 'Total Volume', 'type', 'region', 'month']

with open('prediction.csv', 'w', encoding='UTF8') as f:
    writer = csv.writer(f)
    # write the header
    writer.writerow(header)

    for month in range(1,13):
      for region in range(0,54):
        for type_ in range(0,2):
          feature_type = [1 if type_==i else 0 for i in range(2) ]
          feature_region = [1 if region==i else 0 for i in range(len(region_collection))]
          feature_month = [1 if month==i else 0 for i in range(1,13)]
          x = [feature_type+feature_region+feature_month]
          price = price_model.predict(x)[0]
          consumption = consumption_model.predict(x)[0]
          if type_ == 0:
            type__ = 'conventional'
          else:
            type__ = 'organic'
          region_ = region_collection_reverse[region]
          data = [price, consumption, type__, region_, month]
          writer.writerow(data)